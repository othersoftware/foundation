"use strict";const l=require("vite"),p=require("node:fs"),u=require("node:path");function A(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const n in t)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:()=>t[n]})}}return e.default=t,Object.freeze(e)}const D=A(u);function g(t,e=[".vue"],n=[]){return p.existsSync(t)&&p.readdirSync(t).forEach(s=>{const o=u.join(t,s);p.statSync(o).isDirectory()?n=g(o,e,n):e.forEach(i=>{o.endsWith(i)&&n.push(o)})}),n}function h(t){return t.charAt(0).toUpperCase()+t.slice(1)}function V(t,e,n=void 0){e=l.normalizePath(e),t=l.normalizePath(t);let r=e.replace(t,"").replace(/^\//,"").replace(".vue","").split("/").join(".");return n?n+"::"+r:r}function $(t,e,n=void 0){e=l.normalizePath(e),t=l.normalizePath(t);let r=e.replace(t,"").replace(/^\//,"").replace(".vue","").split("/");return n&&r.unshift(n),r.map(h).join("")}function j(t,e=void 0){t=l.normalizePath(t);let n=u.basename(t),r=u.parse(n),s=h(r.name);return e?h(e)+s:s}function f(t,e,n=void 0){const r=new Map,s=new Map;return Array.isArray(e)&&(e=Object.fromEntries(e.map(o=>[o,void 0]))),typeof e=="string"&&(e={[e]:void 0}),Object.entries(e).forEach(([o,a])=>{a&&m(u.resolve(t.root,a),s,r,n),m(u.resolve(t.root,o),s,void 0,n)}),{components:s,vendors:r}}function m(t,e,n=void 0,r=void 0){g(t).forEach(s=>{let o=j(s,r),a=V(t,s,r),i=$(t,s,r);s=l.normalizePath(s),n&&n.set(i,{global:o,name:i,laravel:a,path:s}),e.set(i,{global:o,name:i,laravel:a,path:s})})}function I(t){let e=[];return t.forEach(n=>e.push(`import ${n.global} from '${n.path}';`)),e.push("export {"),t.forEach(n=>e.push(`  ${n.global},`)),e.push("};"),e.push(""),e.push("export function createOtherSoftwareAutoloader() {"),e.push("  return {"),e.push("    install(app) {"),t.forEach(n=>e.push(`      app.component('${n.global}', ${n.global});`)),e.push("    },"),e.push("  };"),e.push("};"),e.push(""),e.join(`
`)}function d(t,e,n,r){let s=u.resolve(t.root,n),o=u.resolve(s,"components.d.ts"),a=[];a.push("// THIS FILE IS AUTOGENERATED!"),a.push("// DO NOT EDIT!"),a.push(""),a.push(`declare module '@${e.namespace}/components' {`),a.push("  import { Plugin } from 'vue';"),a.push("  export function createOtherSoftwareAutoloader(): Plugin;"),a.push(""),r.forEach(i=>a.push(`  export { default as ${i.global} } from '${l.normalizePath(u.relative(s,i.path))}';`)),a.push("}"),a.push(""),p.writeFileSync(o,a.join(`
`))}function w(t,e,n){let r=u.resolve(t.root,e),s=u.resolve(r,"vue.d.ts"),o=[];o.push("// THIS FILE IS AUTOGENERATED!"),o.push("// DO NOT EDIT!"),o.push(""),o.push("declare module '@vue/runtime-core' {"),o.push("  export interface GlobalComponents {"),n.forEach(a=>o.push(`    ${a.global}: typeof import('${l.normalizePath(u.relative(r,a.path))}')['default'],`)),o.push("  }"),o.push("}"),o.push(""),o.push("export {}"),o.push(""),p.writeFileSync(s,o.join(`
`))}function O(t){return Array.isArray(t)?[t.at(0),void 0]:typeof t=="string"?[t,void 0]:Object.entries(t).at(0)}function v(t,e,n=!0){const r=O(e.target);if(!r)throw new Error("Unknown target for output files!");let[s,o]=r,a=f(t,e.components);return o&&(d(t,e,o,a.vendors),w(t,o,a.vendors)),d(t,e,s,a.components),w(t,s,a.components),n?I(a.components):null}function P(t){let e=[];return t.forEach(n=>e.push(`import ${n.name} from '${n.path}';`)),e.push(""),e.push("const ViewsRepository = {"),t.forEach(n=>e.push(`  '${n.laravel}': ${n.name},`)),e.push("};"),e.push(""),e.push("export function createViewResolver(name) {"),e.push("  const view = ViewsRepository[name];"),e.push(""),e.push("  if (!view) {"),e.push(`    throw new Error('View "' + name + '" not found!');`),e.push("  }"),e.push(""),e.push("  return view;"),e.push("}"),e.push(""),e.join(`
`)}function E(t,e){let n=u.resolve(t.root,e),r=u.resolve(n,"views.d.ts"),s=[];s.push("// THIS FILE IS AUTOGENERATED!"),s.push("// DO NOT EDIT!"),s.push(""),s.push("declare module '@app/views' {"),s.push("  export function createViewResolver(name: string): any;"),s.push("}"),s.push(""),p.writeFileSync(r,s.join(`
`))}function y(t,e,n){let r=u.resolve(t.root,e),s=u.resolve(r,".phpstorm.meta.php"),o=[],a=[];n.forEach(i=>a.push(`'${i.laravel}'`)),o.push("<?php"),o.push(""),o.push("namespace PHPSTORM_META {"),o.push(`  registerArgumentsSet('vueApplicationViews', ${a.join(", ")});`),o.push(""),o.push("  expectedArguments(\\OtherSoftware\\Bridge\\ResponseFactory::view(), 0, argumentsSet('vueApplicationViews'));"),o.push("  expectedArguments(\\OtherSoftware\\Support\\Facades\\Vue::view(), 0, argumentsSet('vueApplicationViews'));"),o.push("}"),o.push(""),p.writeFileSync(s,o.join(`
`))}function S(t,e,n=!0){const r=O(e.target);if(!r)throw new Error("Unknown target for output files!");let[s,o]=r;const a=f(t,e.views,e.namespace);return o&&(E(t,o),y(t,o,a.vendors)),E(t,s),y(t,s,a.components),n?P(a.components):null}let c;function T(t,e){let n=f(t,e.views,e.namespace);c=new Set,n.components.forEach(r=>{c.add(r.path)})}function b(t,e){T(t,e)}function M(t,e,n,r){c||T(t,e);const s=D.normalize(r);if(!r.endsWith(".vue")||!c.has(s))return{code:n,map:null};if(n.includes("<template>")&&!n.includes("<RouterView")&&!n.includes("<router-view")){const o=n.lastIndexOf("</template>"),a=n.slice(0,o),i=n.slice(o);return{code:`${a}
  <RouterView />
${i}`,map:null}}return{code:n,map:null}}function x(t){let e;function n(r){v(e,t,!1),S(e,t,!1),b(e,t);const s=r.moduleGraph.getModuleById("\0@"+t.namespace+"/components"),o=r.moduleGraph.getModuleById("\0@"+t.namespace+"/views");s&&r.reloadModule(s),o&&r.reloadModule(o)}return{name:"vue-autoloader",enforce:"pre",configResolved(r){e=r},resolveId(r){if(r==="@"+t.namespace+"/components")return"\0@"+t.namespace+"/components";if(r==="@"+t.namespace+"/views")return"\0@"+t.namespace+"/views"},load(r){if(r==="\0@"+t.namespace+"/components")return v(e,t);if(r==="\0@"+t.namespace+"/views")return S(e,t)},async transform(r,s){return M(e,t,r,s)},configureServer(r){const s=o=>{o.endsWith(".vue")&&n(r)};r.watcher.on("add",s),r.watcher.on("unlink",s),r.watcher.on("addDir",s),r.watcher.on("unlinkDir",s)}}}module.exports=x;
