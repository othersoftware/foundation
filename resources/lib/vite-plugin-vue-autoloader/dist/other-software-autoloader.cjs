"use strict";const l=require("vite"),p=require("node:fs"),u=require("node:path");function A(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const n in t)if(n!=="default"){const o=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,o.get?o:{enumerable:!0,get:()=>t[n]})}}return e.default=t,Object.freeze(e)}const $=A(u);function g(t,e=[".vue"],n=[]){return p.existsSync(t)&&p.readdirSync(t).forEach(a=>{const r=u.join(t,a);p.statSync(r).isDirectory()?n=g(r,e,n):e.forEach(i=>{r.endsWith(i)&&n.push(r)})}),n}function h(t){return t.charAt(0).toUpperCase()+t.slice(1)}function D(t,e,n=void 0){e=l.normalizePath(e),t=l.normalizePath(t);let o=e.replace(t,"").replace(/^\//,"").replace(".vue","").split("/").join(".");return n?n+"::"+o:o}function V(t,e,n=void 0){e=l.normalizePath(e),t=l.normalizePath(t);let o=e.replace(t,"").replace(/^\//,"").replace(".vue","").split("/");return n&&o.unshift(n),o.map(h).join("")}function j(t,e=void 0){t=l.normalizePath(t);let n=u.basename(t),o=u.parse(n),a=h(o.name);return e?h(e)+a:a}function f(t,e,n=void 0){const o=new Map,a=new Map;return Array.isArray(e)&&(e=Object.fromEntries(e.map(r=>[r,void 0]))),typeof e=="string"&&(e={[e]:void 0}),Object.entries(e).forEach(([r,s])=>{s&&m(u.resolve(t.root,s),a,o,n),m(u.resolve(t.root,r),a,void 0,n)}),{components:a,vendors:o}}function m(t,e,n=void 0,o=void 0){g(t).forEach(a=>{let r=j(a,o),s=D(t,a,o),i=V(t,a,o);a=l.normalizePath(a),n&&n.set(i,{global:r,name:i,laravel:s,path:a}),e.set(i,{global:r,name:i,laravel:s,path:a})})}function I(t){let e=[];return t.forEach(n=>e.push(`import ${n.global} from '${n.path}';`)),e.push("export {"),t.forEach(n=>e.push(`  ${n.global},`)),e.push("};"),e.push(""),e.push("export function createOtherSoftwareAutoloader() {"),e.push("  return {"),e.push("    install(app) {"),t.forEach(n=>e.push(`      app.component('${n.global}', ${n.global});`)),e.push("    },"),e.push("  };"),e.push("};"),e.push(""),e.join(`
`)}function d(t,e,n,o){let a=u.resolve(t.root,n),r=u.resolve(a,"components.d.ts"),s=[];s.push("// THIS FILE IS AUTOGENERATED!"),s.push("// DO NOT EDIT!"),s.push(""),s.push(`declare module '@${e.namespace}/components' {`),s.push("  import { Plugin } from 'vue';"),s.push("  export function createOtherSoftwareAutoloader(): Plugin;"),s.push(""),o.forEach(i=>s.push(`  export { default as ${i.global} } from '${l.normalizePath(u.relative(a,i.path))}';`)),s.push("}"),s.push(""),p.writeFileSync(r,s.join(`
`))}function w(t,e,n){let o=u.resolve(t.root,e),a=u.resolve(o,"vue.d.ts"),r=[];r.push("// THIS FILE IS AUTOGENERATED!"),r.push("// DO NOT EDIT!"),r.push(""),r.push("declare module '@vue/runtime-core' {"),r.push("  export interface GlobalComponents {"),n.forEach(s=>r.push(`    ${s.global}: typeof import('${l.normalizePath(u.relative(o,s.path))}')['default'],`)),r.push("  }"),r.push("}"),r.push(""),r.push("export {}"),r.push(""),p.writeFileSync(a,r.join(`
`))}function O(t){return Array.isArray(t)?[t.at(0),void 0]:typeof t=="string"?[t,void 0]:Object.entries(t).at(0)}function v(t,e,n=!0){const o=O(e.target);if(!o)throw new Error("Unknown target for output files!");let[a,r]=o,s=f(t,e.components);return r&&(d(t,e,r,s.vendors),w(t,r,s.vendors)),d(t,e,a,s.components),w(t,a,s.components),n?I(s.components):null}function P(t){let e=[];return t.forEach(n=>e.push(`import ${n.name} from '${n.path}';`)),e.push(""),e.push("const ViewsRepository = {"),t.forEach(n=>e.push(`  '${n.laravel}': ${n.name},`)),e.push("};"),e.push(""),e.push("export function createViewResolver(name) {"),e.push("  const view = ViewsRepository[name];"),e.push(""),e.push("  if (!view) {"),e.push(`    throw new Error('View "' + name + '" not found!');`),e.push("  }"),e.push(""),e.push("  return view;"),e.push("}"),e.push(""),e.join(`
`)}function E(t,e,n){let o=u.resolve(t.root,n),a=u.resolve(o,"views.d.ts"),r=[];r.push("// THIS FILE IS AUTOGENERATED!"),r.push("// DO NOT EDIT!"),r.push(""),r.push(`declare module '@${e.namespace}/views' {`),r.push("  export function createViewResolver(name: string): any;"),r.push("}"),r.push(""),p.writeFileSync(a,r.join(`
`))}function y(t,e,n){let o=u.resolve(t.root,e),a=u.resolve(o,".phpstorm.meta.php"),r=[],s=[];n.forEach(i=>s.push(`'${i.laravel}'`)),r.push("<?php"),r.push(""),r.push("namespace PHPSTORM_META {"),r.push(`  registerArgumentsSet('vueApplicationViews', ${s.join(", ")});`),r.push(""),r.push("  expectedArguments(\\OtherSoftware\\Bridge\\ResponseFactory::view(), 0, argumentsSet('vueApplicationViews'));"),r.push("  expectedArguments(\\OtherSoftware\\Support\\Facades\\Vue::view(), 0, argumentsSet('vueApplicationViews'));"),r.push("}"),r.push(""),p.writeFileSync(a,r.join(`
`))}function S(t,e,n=!0){const o=O(e.target);if(!o)throw new Error("Unknown target for output files!");let[a,r]=o;const s=f(t,e.views,e.namespace);return r&&(E(t,e,r),y(t,r,s.vendors)),E(t,e,a),y(t,a,s.components),n?P(s.components):null}let c;function T(t,e){let n=f(t,e.views,e.namespace);c=new Set,n.components.forEach(o=>{c.add(o.path)})}function b(t,e){T(t,e)}function M(t,e,n,o){c||T(t,e);const a=$.normalize(o);if(!o.endsWith(".vue")||!c.has(a))return{code:n,map:null};if(n.includes("<template>")&&!n.includes("<RouterView")&&!n.includes("<router-view")){const r=n.lastIndexOf("</template>"),s=n.slice(0,r),i=n.slice(r);return{code:`${s}
  <RouterView />
${i}`,map:null}}return{code:n,map:null}}function x(t){let e;function n(o){v(e,t,!1),S(e,t,!1),b(e,t);const a=o.moduleGraph.getModuleById("\0@"+t.namespace+"/components"),r=o.moduleGraph.getModuleById("\0@"+t.namespace+"/views");a&&o.reloadModule(a),r&&o.reloadModule(r)}return{name:"vue-autoloader",enforce:"pre",configResolved(o){e=o},resolveId(o){if(o==="@"+t.namespace+"/components")return"\0@"+t.namespace+"/components";if(o==="@"+t.namespace+"/views")return"\0@"+t.namespace+"/views"},load(o){if(o==="\0@"+t.namespace+"/components")return v(e,t);if(o==="\0@"+t.namespace+"/views")return S(e,t)},async transform(o,a){return M(e,t,o,a)},configureServer(o){const a=r=>{r.endsWith(".vue")&&n(o)};o.watcher.on("add",a),o.watcher.on("unlink",a),o.watcher.on("addDir",a),o.watcher.on("unlinkDir",a)}}}module.exports=x;
