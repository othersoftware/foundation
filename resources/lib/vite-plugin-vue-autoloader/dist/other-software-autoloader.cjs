"use strict";const i=require("vite"),p=require("node:fs"),u=require("node:path");function A(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const r in t)if(r!=="default"){const o=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,o.get?o:{enumerable:!0,get:()=>t[r]})}}return e.default=t,Object.freeze(e)}const $=A(u);function g(t,e=[".vue"],r=[]){return p.existsSync(t)&&p.readdirSync(t).forEach(a=>{const n=u.join(t,a);p.statSync(n).isDirectory()?r=g(n,e,r):e.forEach(l=>{n.endsWith(l)&&r.push(n)})}),r}function c(t){return t.charAt(0).toUpperCase()+t.slice(1)}function D(t,e,r=void 0){e=i.normalizePath(e),t=i.normalizePath(t);let o=e.replace(t,"").replace(/^\//,"").replace(".vue","").split("/").join(".");return r?r+"::"+o:o}function V(t,e,r=void 0){e=i.normalizePath(e),t=i.normalizePath(t);let o=e.replace(t,"").replace(/^\//,"").replace(".vue","").split("/");return r&&o.unshift(r),o.map(c).join("")}function j(t,e=void 0){t=i.normalizePath(t);let r=u.basename(t),o=u.parse(r),a=c(o.name);return e?c(e)+a:a}function f(t,e,r=void 0){const o=new Map,a=new Map;return Array.isArray(e)&&(e=Object.fromEntries(e.map(n=>[n,void 0]))),typeof e=="string"&&(e={[e]:void 0}),Object.entries(e).forEach(([n,s])=>{s&&m(u.resolve(t.root,s),a,o,r),m(u.resolve(t.root,n),a,void 0,r)}),{components:a,vendors:o}}function m(t,e,r=void 0,o=void 0){g(t).forEach(a=>{let n=j(a,o),s=D(t,a,o),l=V(t,a,o);a=i.normalizePath(a),r&&r.set(l,{global:n,name:l,laravel:s,path:a}),e.set(l,{global:n,name:l,laravel:s,path:a})})}function I(t){let e=[];return t.forEach(r=>e.push(`import ${r.global} from '${r.path}';`)),e.push("export {"),t.forEach(r=>e.push(`  ${r.global},`)),e.push("};"),e.push(""),e.push("export function createOtherSoftwareAutoloader() {"),e.push("  return {"),e.push("    install(app) {"),t.forEach(r=>e.push(`      app.component('${r.global}', ${r.global});`)),e.push("    },"),e.push("  };"),e.push("};"),e.push(""),e.join(`
`)}function d(t,e,r,o){let a=u.resolve(t.root,r),n=u.resolve(a,"components.d.ts"),s=[];s.push("// THIS FILE IS AUTOGENERATED!"),s.push("// DO NOT EDIT!"),s.push(""),s.push(`declare module '@${e.namespace}/components' {`),s.push("  import { Plugin } from 'vue';"),s.push("  export function createOtherSoftwareAutoloader(): Plugin;"),s.push(""),o.forEach(l=>s.push(`  export { default as ${l.global} } from '${i.normalizePath(u.relative(a,l.path))}';`)),s.push("}"),s.push(""),p.writeFileSync(n,s.join(`
`))}function w(t,e,r){let o=u.resolve(t.root,e),a=u.resolve(o,"vue.d.ts"),n=[];n.push("// THIS FILE IS AUTOGENERATED!"),n.push("// DO NOT EDIT!"),n.push(""),n.push("declare module '@vue/runtime-core' {"),n.push("  export interface GlobalComponents {"),r.forEach(s=>n.push(`    ${s.global}: typeof import('${i.normalizePath(u.relative(o,s.path))}')['default'],`)),n.push("  }"),n.push("}"),n.push(""),n.push("export {}"),n.push(""),p.writeFileSync(a,n.join(`
`))}function O(t){return Array.isArray(t)?[t.at(0),void 0]:typeof t=="string"?[t,void 0]:Object.entries(t).at(0)}function v(t,e,r=!0){const o=O(e.target);if(!o)throw new Error("Unknown target for output files!");let[a,n]=o,s=f(t,e.components);return n&&(d(t,e,n,s.vendors),w(t,n,s.vendors)),d(t,e,a,s.components),w(t,a,s.components),r?I(s.components):null}function M(t){let e=[];return t.forEach(r=>e.push(`import ${r.name} from '${r.path}';`)),e.push(""),e.push("const ViewsRepository = {"),t.forEach(r=>e.push(`  '${r.laravel}': ${r.name},`)),e.push("};"),e.push(""),e.push("export function createViewResolver(name) {"),e.push("  const view = ViewsRepository[name];"),e.push(""),e.push("  if (!view) {"),e.push(`    throw new Error('View "' + name + '" not found!');`),e.push("  }"),e.push(""),e.push("  return view;"),e.push("}"),e.push(""),e.join(`
`)}function E(t,e,r){let o=u.resolve(t.root,r),a=u.resolve(o,"views.d.ts"),n=[];n.push("// THIS FILE IS AUTOGENERATED!"),n.push("// DO NOT EDIT!"),n.push(""),n.push(`declare module '@${e.namespace}/views' {`),n.push("  export function createViewResolver(name: string): any;"),n.push("}"),n.push(""),p.writeFileSync(a,n.join(`
`))}function y(t,e,r){let o=u.resolve(t.root,e),a=u.resolve(o,".phpstorm.meta.php"),n=[],s=[];r.forEach(l=>s.push(`'${l.laravel}'`)),n.push("<?php"),n.push(""),n.push("namespace PHPSTORM_META {"),n.push(`  registerArgumentsSet('vueApplicationViews', ${s.join(", ")});`),n.push(""),n.push("  expectedArguments(\\OtherSoftware\\Bridge\\ResponseFactory::view(), 0, argumentsSet('vueApplicationViews'));"),n.push("  expectedArguments(\\OtherSoftware\\Support\\Facades\\Vue::view(), 0, argumentsSet('vueApplicationViews'));"),n.push("}"),n.push(""),p.writeFileSync(a,n.join(`
`))}function S(t,e,r=!0){const o=O(e.target);if(!o)throw new Error("Unknown target for output files!");let[a,n]=o;const s=f(t,e.views,e.namespace);return n&&(E(t,e,n),y(t,n,s.vendors)),E(t,e,a),y(t,a,s.components),r?M(s.components):null}let h=new Map;function T(t,e){let r=f(t,e.views,e.namespace),o=e.namespace||"default",a=new Set;h.set(o,a),r.components.forEach(n=>{a.add(n.path)}),r.vendors.forEach(n=>{a.add(n.path)})}function P(t,e){T(t,e)}function b(t,e,r,o){h.has(e.namespace||"default")||T(t,e);const a=$.normalize(o);if(!o.endsWith(".vue")||!h.get(e.namespace||"default").has(a))return{code:r,map:null};if(r.includes("<template>")&&!r.includes("<RouterView")&&!r.includes("<router-view")){const n=r.lastIndexOf("</template>"),s=r.slice(0,n),l=r.slice(n);return{code:`${s}
  <RouterView />
${l}`,map:null}}return{code:r,map:null}}function x(t){let e;function r(o){v(e,t,!1),S(e,t,!1),P(e,t);const a=o.moduleGraph.getModuleById("\0@"+t.namespace+"/components"),n=o.moduleGraph.getModuleById("\0@"+t.namespace+"/views");a&&o.reloadModule(a),n&&o.reloadModule(n)}return{name:"vue-autoloader",enforce:"pre",configResolved(o){e=o},resolveId(o){if(o==="@"+t.namespace+"/components")return"\0@"+t.namespace+"/components";if(o==="@"+t.namespace+"/views")return"\0@"+t.namespace+"/views"},load(o){if(o==="\0@"+t.namespace+"/components")return v(e,t);if(o==="\0@"+t.namespace+"/views")return S(e,t)},async transform(o,a){return b(e,t,o,a)},configureServer(o){const a=n=>{n.endsWith(".vue")&&r(o)};o.watcher.on("add",a),o.watcher.on("unlink",a),o.watcher.on("addDir",a),o.watcher.on("unlinkDir",a)}}}module.exports=x;
