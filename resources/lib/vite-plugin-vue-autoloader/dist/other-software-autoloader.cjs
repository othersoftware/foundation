"use strict";const i=require("node:fs"),p=require("node:path"),u=require("vite");function g(t){let e=[];return t.forEach(r=>e.push(`import ${r.global} from '${r.path}';`)),e.push("export {"),t.forEach(r=>e.push(`  ${r.global},`)),e.push("};"),e.push(""),e.push("export function createOtherSoftwareAutoLoader() {"),e.push("  return {"),e.push("    install(app) {"),t.forEach(r=>e.push(`      app.component('${r.global}', ${r.global});`)),e.push("    },"),e.push("  };"),e.push("};"),e.push(""),e.join(`
`)}function c(t,e,r){let o=p.resolve(t.root,e),s=p.resolve(o,"components.d.ts"),n=[];n.push("// THIS FILE IS AUTOGENERATED!"),n.push("// DO NOT EDIT!"),n.push(""),n.push("declare module '@app/components' {"),n.push("  import { Plugin } from 'vue';"),n.push("  export function createAutoLoader(): Plugin;"),n.push(""),r.forEach(a=>n.push(`  export { default as ${a.global} } from '${u.normalizePath(p.relative(o,a.path))}';`)),n.push("}"),n.push(""),i.writeFileSync(s,n.join(`
`))}function h(t,e,r){let o=p.resolve(t.root,e),s=p.resolve(o,"vue.d.ts"),n=[];n.push("// THIS FILE IS AUTOGENERATED!"),n.push("// DO NOT EDIT!"),n.push(""),n.push("declare module '@vue/runtime-core' {"),n.push("  export interface GlobalComponents {"),r.forEach(a=>n.push(`    ${a.name}: typeof import('${u.normalizePath(p.relative(o,a.path))}')['default'],`)),n.push("  }"),n.push("}"),n.push(""),n.push("export {}"),n.push(""),i.writeFileSync(s,n.join(`
`))}function E(t,e=[".vue"],r=[]){return i.existsSync(t)&&i.readdirSync(t).forEach(s=>{const n=p.join(t,s);i.statSync(n).isDirectory()?r=E(n,e,r):e.forEach(l=>{n.endsWith(l)&&r.push(n)})}),r}function A(t){return t.replace(/[A-Z]/g,(e,r)=>(r!==0?"_":"")+e.toLowerCase())}function S(t){return t.charAt(0).toUpperCase()+t.slice(1)}function T(t,e){return e=u.normalizePath(e),t=u.normalizePath(t),e.replace(t,"").replace(/^\//,"").replace(".vue","").split("/").map(A).join(".")}function D(t,e){return e=u.normalizePath(e),t=u.normalizePath(t),e.replace(t,"").replace(/^\//,"").replace(".vue","").split("/").map(S).join("")}function O(t){t=u.normalizePath(t);let e=p.basename(t),r=p.parse(e);return S(r.name)}function y(t,e){const r=new Map,o=new Map;return Object.entries(e).forEach(([s,n])=>{n&&f(p.resolve(t.root,n),o,r),f(p.resolve(t.root,s),o)}),{components:o,vendors:r}}function f(t,e,r=void 0){E(t).forEach(o=>{let s=O(o),n=T(t,o),a=D(t,o);o=u.normalizePath(o),r&&r.set(s,{global:s,name:a,laravel:n,path:o}),e.set(s,{global:s,name:a,laravel:n,path:o})})}function m(t,e,r=!0){const o=Object.entries(e.target).at(0);if(!o)throw new Error("Unknown target for output files!");let[s,n]=o,a=y(t,e.components);return n&&(c(t,n,a.vendors),h(t,n,a.vendors)),c(t,s,a.components),h(t,s,a.components),r?g(a.components):null}function $(t){let e=[];return t.forEach(r=>e.push(`import ${r.name} from '${r.path}';`)),e.push("const ViewsRepository = {"),t.forEach(r=>e.push(`  '${r.laravel}': ${r.name},`)),e.push("};"),e.push(""),e.push("export function createViewResolver(name) {"),e.push("  const view = ViewsRepository[name];"),e.push(""),e.push("  if (!view) {"),e.push(`    throw new Error('View "' + name + '" not found!');`),e.push("  }"),e.push(""),e.push("  return view;"),e.push("}"),e.push(""),e.join(`
`)}function d(t,e){let r=p.resolve(t.root,e),o=p.resolve(r,"views.d.ts"),s=[];s.push("// THIS FILE IS AUTOGENERATED!"),s.push("// DO NOT EDIT!"),s.push(""),s.push("declare module '@app/views' {"),s.push("  export function createViewResolver(name: string): any;"),s.push("}"),s.push(""),i.writeFileSync(o,s.join(`
`))}function w(t,e,r){let o=p.resolve(t.root,e),s=p.resolve(o,".phpstorm.meta.php"),n=[],a=[];r.forEach(l=>a.push(`'${l.laravel}'`)),n.push("<?php"),n.push(""),n.push("namespace PHPSTORM_META {"),n.push(`  registerArgumentsSet('vueApplicationViews', ${a.join(", ")});`),n.push(""),n.push("  expectedArguments(\\OtherSoftware\\Foundation\\Frontend\\Factory::view(), 0, argumentsSet('vueApplicationViews'));"),n.push("  expectedArguments(\\OtherSoftware\\Foundation\\Facades\\Frontend::view(), 0, argumentsSet('vueApplicationViews'));"),n.push("}"),n.push(""),i.writeFileSync(s,n.join(`
`))}function v(t,e,r=!0){const o=Object.entries(e.target).at(0);if(!o)throw new Error("Unknown target for output files!");let[s,n]=o;const a=y(t,e.views);return n&&(d(t,n),w(t,n,a.vendors)),d(t,s),w(t,s,a.components),r?$(a.components):null}function I(t){let e;function r(o){m(e,t,!1),v(e,t,!1);const s=o.moduleGraph.getModuleById("\0@app/components"),n=o.moduleGraph.getModuleById("\0@app/views");s&&o.reloadModule(s),n&&o.reloadModule(n)}return{name:"vue-autoloader",configResolved(o){e=o},resolveId(o){if(o==="@app/components")return"\0@app/components";if(o==="@app/views")return"\0@app/views"},load(o){if(o==="\0@app/components")return m(e,t);if(o==="\0@app/views")return v(e,t)},configureServer(o){const s=n=>{n.endsWith(".vue")&&r(o)};o.watcher.on("add",s),o.watcher.on("unlink",s),o.watcher.on("addDir",s),o.watcher.on("unlinkDir",s)}}}module.exports=I;
